<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../css/bootstrap/css/bootstrap.css">
  <style>
    #register {
      width: 50%;
      margin-top: 200px;
    }

    .ok:after {
      content: "√";
      color: green;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bold;
    }

    .ng::after {
      content: "×";
      color: red;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bold;
    }
  </style>
  <title>Document</title>
</head>

<body>
  <!-- 
        特点：
        1. 会进行页面跳转
        2. 只能发get和post请求
     -->


  <div class="panel panel-primary center-block" id="register">
    <div class="panel-heading">
      <h3 class="panel-title">注册</h3>
    </div>
    <div class="panel-body">
      <form action="/Gavin-lin9.github.io/api/register.php" method="POST">
        <div class="form-group">
          <div class="input-group">
            <div class="input-group-addon ">
              <i class="glyphicon glyphicon-user"></i>
            </div>
            <input type="text" name="username" class="form-control" placeholder="请输入用户名">
            <div class="input-group-addon" id="user-validation">
              <!-- <i class="glyphicon glyphicon-user"></i> -->

            </div>
          </div>
          <br>
          <div class="input-group">
            <div class="input-group-addon ">
              <i class="glyphicon glyphicon-lock"></i>
            </div>
            <input type="text" name="password" class="form-control" placeholder="请输入密码">
          </div>
          <br>
          <div class="input-group">
            <button type="submit" class="btn btn-primary">注册</button>
            <a type="button" class="btn btn-link" href="./login.html">登录</a>
          </div>
        </div>
      </form>
    </div>
  </div>
  <script>
    document.querySelector('input[name="username"]').onblur = function () {
      //1. 取得这个input的value
      let user = this.value;
      //2. 发送一个请求给后端，带着用户名
      let xhr = new XMLHttpRequest();
      xhr.open('GET', `/Gavin-lin9.github.io
      /api/checkuser.php?username=${user}`, true);

      // xhr.onreadystatechange = function () {
      //     if (this.readyState !== 4) {
      //         return;
      //     }

      //     if (this.status >= 200 && this.status < 300) {
      //         //响应了
      //     } else {
      //         //请求失败。
      //     }

      // }

      xhr.onload = function () {
        //相当于onreadystatechange中，readyState===4的情况

        //3. 等待响应，根据结果，显示用户名是否可用
        if (this.status >= 200 && this.status < 300) {
          //响应了
          //php echo的内容，就是我们的this.responseText
          // console.log(this.responseText)
          let userValidation = document.querySelector('#user-validation');
          if (this.responseText === '不可用') {
            userValidation.classList.remove('ok')
            userValidation.classList.add('ng')
          } else {
            userValidation.classList.remove('ng')
            userValidation.classList.add('ok')
          }

        } else {
          //请求失败。

        }
      }

      xhr.send();

    }
  </script>
</body>

</html>